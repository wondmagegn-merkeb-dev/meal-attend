{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,iBAAiB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACvB,4VACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAC5B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,gKAAA,CAAA,OAAI,GAAG;IAC9B,qBACE,8OAAC;QACC,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,OAAO,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n"],"names":[],"mappings":";;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,qBAAO,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG1B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,4DACA;QAED,GAAG,KAAK;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,sDACA;QAED,GAAG,KAAK;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGrC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QAAI,KAAK;QAAK,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,YAAY;QAAa,GAAG,KAAK;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;;AAEA,MAAM,sBAAQ,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAC3B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,8OAAC;QACC,MAAM;QACN,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,kYACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,MAAM,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/label.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAEA;AANA;;;;;;AAQA,MAAM,gBAAgB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACtB;AAGF,MAAM,sBAAQ,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAI3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,iKAAA,CAAA,OAAmB;QAClB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iBAAiB;QAC9B,GAAG,KAAK;;;;;;AAGb,MAAM,WAAW,GAAG,iKAAA,CAAA,OAAmB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 233, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/constants.ts"],"sourcesContent":["\nexport const WELCOME_BANNER_DISMISSED_KEY = 'mealAttendWelcomeBannerDismissed_v1';\nexport const STUDENTS_STORAGE_KEY = 'mealAttendStudentsList_v1';\nexport const USERS_STORAGE_KEY = 'mealAttendUsersList_v1';\nexport const DEPARTMENTS_STORAGE_KEY = 'mealAttendDepartmentsList_v1';\nexport const ATTENDANCE_RECORDS_STORAGE_KEY = 'mealAttendAttendanceRecords_v1';\nexport const AUTH_TOKEN_KEY = 'mealAttendAuthToken_v1';\nexport const CURRENT_USER_ROLE_KEY = 'mealAttendCurrentUserRole_v1';\nexport const CURRENT_USER_ID_KEY = 'mealAttendCurrentUserId_v1';\nexport const CURRENT_USER_DETAILS_KEY = 'mealAttendCurrentUserDetails_v1';\nexport const PASSWORD_CHANGE_REQUIRED_KEY_PREFIX = 'mealAttendPasswordChangeRequired_';\nexport const USER_ACTIVITY_LOG_KEY = 'mealAttendUserActivityLog_v1'; // New key for activity logs\n    \n"],"names":[],"mappings":";;;;;;;;;;;;;AACO,MAAM,+BAA+B;AACrC,MAAM,uBAAuB;AAC7B,MAAM,oBAAoB;AAC1B,MAAM,0BAA0B;AAChC,MAAM,iCAAiC;AACvC,MAAM,iBAAiB;AACvB,MAAM,wBAAwB;AAC9B,MAAM,sBAAsB;AAC5B,MAAM,2BAA2B;AACjC,MAAM,sCAAsC;AAC5C,MAAM,wBAAwB,gCAAgC,4BAA4B","debugId":null}},
    {"offset": {"line": 263, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/activityLogger.ts"],"sourcesContent":["\nimport { USER_ACTIVITY_LOG_KEY } from './constants';\nimport type { UserActivityLog } from '@/types/activity';\nimport { formatISO } from 'date-fns';\n\nconst MAX_LOGS = 500; // Limit the number of logs to prevent localStorage bloat\n\nexport function logUserActivity(userId: string | null, action: string, details?: string) {\n  const effectiveUserId = userId || 'unknown_user'; // Use 'unknown_user' if userId is null\n\n  try {\n    const newLog: UserActivityLog = {\n      id: `log_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`,\n      userId: effectiveUserId,\n      timestamp: formatISO(new Date()),\n      action,\n      details,\n    };\n\n    const storedLogsRaw = localStorage.getItem(USER_ACTIVITY_LOG_KEY);\n    let logs: UserActivityLog[] = storedLogsRaw ? JSON.parse(storedLogsRaw) : [];\n    \n    logs.unshift(newLog); // Add new log to the beginning\n\n    if (logs.length > MAX_LOGS) {\n      logs = logs.slice(0, MAX_LOGS);\n    }\n\n    localStorage.setItem(USER_ACTIVITY_LOG_KEY, JSON.stringify(logs));\n  } catch (error) {\n    console.error(\"Failed to log user activity:\", error);\n    // Optionally, add a toast notification here if logging fails, though it might be too noisy.\n  }\n}\n"],"names":[],"mappings":";;;AACA;AAEA;;;AAEA,MAAM,WAAW,KAAK,yDAAyD;AAExE,SAAS,gBAAgB,MAAqB,EAAE,MAAc,EAAE,OAAgB;IACrF,MAAM,kBAAkB,UAAU,gBAAgB,uCAAuC;IAEzF,IAAI;QACF,MAAM,SAA0B;YAC9B,IAAI,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,IAAI;YACrE,QAAQ;YACR,WAAW,CAAA,GAAA,yIAAA,CAAA,YAAS,AAAD,EAAE,IAAI;YACzB;YACA;QACF;QAEA,MAAM,gBAAgB,aAAa,OAAO,CAAC,uHAAA,CAAA,wBAAqB;QAChE,IAAI,OAA0B,gBAAgB,KAAK,KAAK,CAAC,iBAAiB,EAAE;QAE5E,KAAK,OAAO,CAAC,SAAS,+BAA+B;QAErD,IAAI,KAAK,MAAM,GAAG,UAAU;YAC1B,OAAO,KAAK,KAAK,CAAC,GAAG;QACvB;QAEA,aAAa,OAAO,CAAC,uHAAA,CAAA,wBAAqB,EAAE,KAAK,SAAS,CAAC;IAC7D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;IAC9C,4FAA4F;IAC9F;AACF","debugId":null}},
    {"offset": {"line": 299, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/hooks/useAuth.ts"],"sourcesContent":["\n\"use client\";\n\nimport type { Dispatch, SetStateAction} from 'react';\nimport { useState, useEffect, useCallback } from 'react';\nimport { useRouter } from 'next/navigation';\nimport {\n  AUTH_TOKEN_KEY,\n  USERS_STORAGE_KEY,\n  CURRENT_USER_ROLE_KEY,\n  CURRENT_USER_ID_KEY,\n  PASSWORD_CHANGE_REQUIRED_KEY_PREFIX,\n  CURRENT_USER_DETAILS_KEY,\n} from '@/lib/constants';\nimport { useToast } from './use-toast';\nimport type { User } from '@/types/user';\nimport { logUserActivity } from '@/lib/activityLogger';\n\nconst MOCK_DEFAULT_PASSWORD = \"password123\";\n\nconst MOCK_DEFAULT_ADMIN_USER: User = {\n  id: 'usr_smp_001_fallback',\n  userId: 'ADERA/USR/2024/00001',\n  fullName: 'Alice Admin (Fallback)',\n  department: 'Administration',\n  email: 'alice.admin@example.com',\n  role: 'Admin',\n  profileImageURL: 'https://placehold.co/100x100.png?text=AA',\n  createdAt: new Date('2023-01-10T10:00:00Z').toISOString(),\n  updatedAt: new Date('2023-01-10T10:00:00Z').toISOString(),\n};\n\ninterface AuthContextType {\n  isAuthenticated: boolean | null;\n  currentUser: User | null;\n  currentUserRole: User['role'] | null;\n  currentUserId: string | null; // ADERA User ID\n  isPasswordChangeRequired: boolean;\n  login: (userIdInput?: string, password?: string) => Promise<boolean>;\n  logout: () => void;\n  clearPasswordChangeRequirement: () => void;\n  setIsAuthenticated: Dispatch<SetStateAction<boolean | null>>;\n  updateCurrentUserDetails: (updatedDetails: Partial<User>) => void;\n}\n\nexport function useAuth(): AuthContextType {\n  const [isAuthenticated, setIsAuthenticated] = useState<boolean | null>(null);\n  const [currentUser, setCurrentUser] = useState<User | null>(null);\n  const [isPasswordChangeRequired, setIsPasswordChangeRequired] = useState<boolean>(false);\n  const router = useRouter();\n  const { toast } = useToast();\n\n  const currentUserRole = currentUser?.role || null;\n  const currentUserId = currentUser?.userId || null;\n\n  const checkPasswordChangeStatus = useCallback((userIdToCheck: string | null) => {\n    if (!userIdToCheck) {\n      setIsPasswordChangeRequired(false);\n      return;\n    }\n    try {\n      const changeRequired = localStorage.getItem(PASSWORD_CHANGE_REQUIRED_KEY_PREFIX + userIdToCheck);\n      setIsPasswordChangeRequired(changeRequired === 'true');\n    } catch (e) {\n      console.error(\"localStorage access error for password change status:\", e);\n      setIsPasswordChangeRequired(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    try {\n      const token = localStorage.getItem(AUTH_TOKEN_KEY);\n      const storedUserDetailsRaw = localStorage.getItem(CURRENT_USER_DETAILS_KEY);\n      \n      if (token && storedUserDetailsRaw) {\n        const storedUser: User = JSON.parse(storedUserDetailsRaw);\n        setIsAuthenticated(true);\n        setCurrentUser(storedUser);\n        checkPasswordChangeStatus(storedUser.userId);\n      } else {\n        setIsAuthenticated(false);\n        setCurrentUser(null);\n        setIsPasswordChangeRequired(false);\n      }\n\n    } catch (e) {\n      console.error(\"localStorage access error:\", e);\n      setIsAuthenticated(false);\n      setCurrentUser(null);\n      setIsPasswordChangeRequired(false);\n    }\n  }, [checkPasswordChangeStatus]);\n\n  const login = useCallback(async (userIdInput?: string, password?: string): Promise<boolean> => {\n    return new Promise((resolve) => {\n      setTimeout(() => {\n        try {\n          const storedUsersRaw = localStorage.getItem(USERS_STORAGE_KEY);\n          let usersToSearch: User[] = [];\n\n          if (storedUsersRaw) {\n            try {\n              usersToSearch = JSON.parse(storedUsersRaw);\n            } catch (parseError) {\n              console.error(\"Failed to parse users from localStorage\", parseError);\n              usersToSearch = []; \n            }\n          }\n          \n          const adminExistsInStorage = usersToSearch.some(u => u.userId === MOCK_DEFAULT_ADMIN_USER.userId);\n          if (!adminExistsInStorage && MOCK_DEFAULT_ADMIN_USER.userId === userIdInput) { // Ensure we add if it's the one being searched for\n            usersToSearch.push(MOCK_DEFAULT_ADMIN_USER);\n          }\n          \n          const user = usersToSearch.find(u => u.userId === userIdInput);\n\n          if (user && password === MOCK_DEFAULT_PASSWORD) {\n            localStorage.setItem(AUTH_TOKEN_KEY, `mock-jwt-token-for-${user.userId}`);\n            localStorage.setItem(CURRENT_USER_DETAILS_KEY, JSON.stringify(user));\n            localStorage.setItem(CURRENT_USER_ROLE_KEY, user.role);\n            localStorage.setItem(CURRENT_USER_ID_KEY, user.userId); \n\n            setIsAuthenticated(true);\n            setCurrentUser(user);\n\n            const passwordChangeDismissedKey = PASSWORD_CHANGE_REQUIRED_KEY_PREFIX + user.userId + \"_dismissed\";\n            const passwordChangeRequiredKey = PASSWORD_CHANGE_REQUIRED_KEY_PREFIX + user.userId;\n            const passwordChangeDismissed = localStorage.getItem(passwordChangeDismissedKey);\n\n            if (!passwordChangeDismissed) {\n              localStorage.setItem(passwordChangeRequiredKey, 'true');\n              setIsPasswordChangeRequired(true);\n            } else {\n              localStorage.removeItem(passwordChangeRequiredKey);\n              setIsPasswordChangeRequired(false);\n            }\n            \n            logUserActivity(user.userId, \"LOGIN_SUCCESS\");\n            toast({ title: \"Login Successful\", description: `Welcome back, ${user.fullName}!` });\n            resolve(true);\n          } else {\n            logUserActivity(userIdInput || 'unknown_user', \"LOGIN_FAILURE\", \"Invalid User ID or password.\");\n            toast({ title: \"Login Failed\", description: \"Invalid User ID or password.\", variant: \"destructive\" });\n            resolve(false);\n          }\n        } catch (e) {\n          console.error(\"Login error:\", e);\n          logUserActivity(userIdInput || 'unknown_user', \"LOGIN_ERROR\", \"An unexpected error occurred during login.\");\n          toast({ title: \"Login Error\", description: \"An unexpected error occurred.\", variant: \"destructive\" });\n          resolve(false);\n        }\n      }, 500);\n    });\n  }, [toast]); \n\n  const logout = useCallback(() => {\n    const loggingOutUserId = currentUser?.userId || null;\n    try {\n      localStorage.removeItem(AUTH_TOKEN_KEY);\n      localStorage.removeItem(CURRENT_USER_ROLE_KEY);\n      localStorage.removeItem(CURRENT_USER_ID_KEY);\n      localStorage.removeItem(CURRENT_USER_DETAILS_KEY);\n\n      setIsAuthenticated(false);\n      setCurrentUser(null);\n      setIsPasswordChangeRequired(false); \n      \n      if (loggingOutUserId) {\n        logUserActivity(loggingOutUserId, \"LOGOUT_SUCCESS\");\n      }\n      toast({ title: \"Logged Out\", description: \"You have been successfully logged out.\" });\n      router.push('/auth/login');\n    } catch (e) {\n      if (loggingOutUserId) {\n        logUserActivity(loggingOutUserId, \"LOGOUT_ERROR\", \"Failed to clear session.\");\n      }\n      toast({ title: \"Logout Error\", description: \"Could not clear session.\", variant: \"destructive\" });\n    }\n  }, [router, toast, currentUser]);\n\n  const clearPasswordChangeRequirement = useCallback(() => {\n    const uid = currentUser?.userId;\n    if (uid) {\n      try {\n        localStorage.setItem(PASSWORD_CHANGE_REQUIRED_KEY_PREFIX + uid + \"_dismissed\", 'true');\n        localStorage.removeItem(PASSWORD_CHANGE_REQUIRED_KEY_PREFIX + uid);\n        setIsPasswordChangeRequired(false);\n        logUserActivity(uid, \"PASSWORD_CHANGE_FLAG_CLEARED\");\n      } catch (e) {\n        console.error(\"Error clearing password change requirement flag:\", e);\n      }\n    }\n  }, [currentUser]);\n\n  const updateCurrentUserDetails = useCallback((updatedDetails: Partial<User>) => {\n    if (!currentUser) return;\n\n    const updatedUser: User = { ...currentUser, ...updatedDetails, updatedAt: new Date().toISOString() };\n    \n    setCurrentUser(updatedUser);\n    localStorage.setItem(CURRENT_USER_DETAILS_KEY, JSON.stringify(updatedUser));\n\n    try {\n      const storedUsersRaw = localStorage.getItem(USERS_STORAGE_KEY);\n      let users: User[] = storedUsersRaw ? JSON.parse(storedUsersRaw) : [];\n      const userIndex = users.findIndex(u => u.id === updatedUser.id);\n      if (userIndex > -1) {\n        users[userIndex] = updatedUser;\n      } else {\n        users.push(updatedUser); \n      }\n      localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users));\n      \n      window.dispatchEvent(new StorageEvent('storage', { key: USERS_STORAGE_KEY, newValue: JSON.stringify(users) }));\n      window.dispatchEvent(new StorageEvent('storage', { key: CURRENT_USER_DETAILS_KEY, newValue: JSON.stringify(updatedUser) }));\n\n    } catch (error) {\n      console.error(\"Failed to update user details in USERS_STORAGE_KEY:\", error);\n      toast({ title: \"Storage Error\", description: \"Could not update user in main list.\", variant: \"destructive\" });\n    }\n    toast({ title: \"Profile Updated\", description: \"Your profile details have been saved.\" });\n  }, [currentUser, toast]);\n\n\n  return { \n    isAuthenticated, \n    currentUser,\n    currentUserRole, \n    currentUserId, \n    isPasswordChangeRequired, \n    login, \n    logout, \n    clearPasswordChangeRequirement, \n    setIsAuthenticated,\n    updateCurrentUserDetails\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 545, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/auth/login/page.tsx"],"sourcesContent":["\n\"use client\";\n\nimport { useState } from 'react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useAuth } from '@/hooks/useAuth';\nimport { Loader2, LogIn, Salad } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\nexport default function LoginPage() {\n  const [userId, setUserId] = useState('');\n  const [password, setPassword] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const { login, isPasswordChangeRequired } = useAuth();\n  const router = useRouter();\n  const { toast } = useToast();\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    if (!userId || !password) {\n      toast({\n        title: \"Missing Fields\",\n        description: \"Please enter both User ID and password.\",\n        variant: \"destructive\",\n      });\n      setIsLoading(false);\n      return;\n    }\n    const success = await login(userId, password);\n    setIsLoading(false);\n    if (success) {\n      // AuthGuard will handle redirection if password change is required\n      // So, we can directly try to push to /admin, AuthGuard will intercept if needed\n      router.push('/admin'); \n    }\n  };\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 p-4\">\n      <Card className=\"w-full max-w-md shadow-2xl\">\n        <CardHeader className=\"text-center\">\n          <div className=\"flex justify-center mb-4\">\n            <Salad className=\"h-16 w-16 text-primary\" />\n          </div>\n          <CardTitle className=\"text-3xl font-bold\">Welcome Back!</CardTitle>\n          <CardDescription>Sign in to access your MealAttend dashboard.</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleLogin} className=\"space-y-6\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"userId\">User ID</Label>\n              <Input\n                id=\"userId\"\n                type=\"text\"\n                placeholder=\"e.g., ADERA/USR/2024/00001\"\n                value={userId}\n                onChange={(e) => setUserId(e.target.value)}\n                required\n                disabled={isLoading}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Password</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                placeholder=\"••••••••\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n                disabled={isLoading}\n              />\n            </div>\n            <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n              {isLoading ? (\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n              ) : (\n                <LogIn className=\"mr-2 h-4 w-4\" />\n              )}\n              Sign In\n            </Button>\n          </form>\n        </CardContent>\n        <CardFooter className=\"flex flex-col items-center space-y-2\">\n          <Link href=\"/auth/forgot-password\" legacyBehavior>\n            <a className=\"text-sm text-primary hover:underline\">\n              Forgot your password?\n            </a>\n          </Link>\n           <p className=\"text-xs text-muted-foreground mt-4\">\n            Hint: User ID e.g., <code className=\"bg-muted px-1 py-0.5 rounded-sm\">ADERA/USR/2024/00001</code> / Password: <code className=\"bg-muted px-1 py-0.5 rounded-sm\">password123</code>\n          </p>\n        </CardFooter>\n      </Card>\n    </div>\n  );\n}\n    \n"],"names":[],"mappings":"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","debugId":null}}]
}